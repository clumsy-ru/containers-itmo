# Лабораторная работа №1  
## Плохие и хорошие практики при написании Dockerfile

В рамках данной лабораторной работы были подготовлены два Dockerfile для одного и того же приложения:
- `Dockerfile.bad` — рабочий Dockerfile, содержащий намеренно допущенные плохие практики;
- `Dockerfile.good` — улучшенная версия, в которой эти практики исправлены.

Цель работы — разобрать распространённые ошибки при написании Dockerfile, понять, почему они считаются плохими, и показать корректные способы их исправления.

---

## Описание приложения

В обоих Dockerfile используется одно и то же приложение — простой HTTP-сервис на Flask.

Функциональность приложения:
- отвечает на HTTP-запросы;
- считает количество обращений;
- сохраняет счётчик и лог запросов во внешнюю директорию `/data`.

Директория `/data` подключается с хоста через volume, что позволяет сохранять данные вне контейнера.

---

## Анализ Dockerfile.bad

`Dockerfile.bad` успешно собирается и запускается, однако содержит ряд плохих практик.

### 1. Использование `python:latest` в качестве базового образа

Использование тега `latest` не фиксирует конкретную версию Python.

**Почему это плохо:**
- содержимое образа может измениться со временем;
- сборка становится невоспроизводимой;
- возможны неожиданные ошибки при обновлении базового образа.

---

### 2. Установка лишних пакетов и отсутствие очистки apt-кэша

В Dockerfile устанавливаются дополнительные пакеты, которые не используются приложением, а также не очищается кэш пакетного менеджера.

**Почему это плохо:**
- увеличивается размер образа;
- в образе остаются ненужные файлы;
- усложняется поддержка и обновление образа.

---

### 3. Копирование всего контекста сборки (`COPY . /app`)

Копируется вся директория проекта без фильтрации.

**Почему это плохо:**
- в образ могут попасть лишние файлы (git-репозиторий, кэши, временные данные);
- ухудшается кеширование слоёв Docker;
- увеличивается размер итогового образа.

---

### 4. Запуск контейнера от пользователя root

По умолчанию контейнер запускается от root.

**Почему это плохо:**
- повышаются риски безопасности;
- при наличии уязвимостей в приложении или зависимостях последствия могут быть серьёзнее.

---

### 5. Использование shell-form для команды запуска

Команда запуска приложения записана в shell-форме.

**Почему это считается плохой практикой:**
- сигналы операционной системы обрабатываются менее корректно;
- контейнер может неправильно завершаться.

---

## Анализ Dockerfile.good

`Dockerfile.good` решает те же задачи, но с соблюдением хороших практик.

### 1. Фиксированная версия базового образа

Используется конкретная версия Python (`python:3.12-slim`).

**Преимущества:**
- воспроизводимость сборки;
- предсказуемое поведение;
- уменьшенный размер образа.

---

### 2. Минимальная установка зависимостей и очистка системы

- пакеты устанавливаются в одном слое;
- используется `--no-install-recommends`;
- очищается apt-кэш.

**Результат:** более лёгкий и аккуратный образ.

---

### 3. Оптимизированное копирование файлов

- используется `.dockerignore`;
- зависимости копируются и устанавливаются отдельно;
- в образ попадают только необходимые файлы приложения.

**Преимущества:**
- лучшее кеширование;
- отсутствие лишних файлов в образе.

---

### 4. Использование непривилегированного пользователя

Контейнер запускается не от root.

**Почему это хорошо:**
- повышается безопасность;
- соответствует рекомендуемым практикам Docker.

---

### 5. Использование exec-form для команды запуска

Команда запуска приложения записана в exec-форме.

**Преимущества:**
- корректная обработка сигналов;
- корректное завершение контейнера.

---

## Плохие практики использования контейнеризации (не связанные с Dockerfile)

### 1. Запуск контейнеров без ограничений ресурсов

**Почему это плохо:**
- контейнер может занять всю доступную память или CPU;
- особенно критично на слабых компьютерах.

**Как правильно:**
- задавать ограничения по памяти и CPU при запуске контейнера.

---

### 2. Хранение данных внутри контейнера без использования volume

**Почему это плохо:**
- при удалении или пересоздании контейнера данные теряются;
- затрудняется резервное копирование данных.

**Как правильно:**
- использовать volume или bind mount для хранения данных.

---

## Итог

В данной лабораторной работе были рассмотрены типичные ошибки при написании Dockerfile и показаны способы их исправления.  
Работа демонстрирует разницу между Dockerfile, который просто работает, и Dockerfile, написанным с учётом хороших практик контейнеризации.
